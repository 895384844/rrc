function loadImage(e){if(""!==e.value){var o=$(".avat");operationImg(o,e)}}function uploaAva(e){$.ajaxFileUpload({url:InterFace.upload+"?key="+e,secureuri:!1,fileElementId:"inputfiles",dataType:"text/html"})}function getAvaFunc(e){"200"==e.errCode?$("#imgUrl").val(e.imgUrl):"400"==e.errCode&&(M.dialog1=jqueryAlert({content:"上传失败",closeTime:1e3,modal:!0}))}function addImgHtml(e,o){$(".avat")&&$(".avat").find("img").attr("src",o)}function changeAva_fn(e){console.log(e),"200"==e.errCode&&(M.dialog1=jqueryAlert({content:"更换成功",closeTime:1e3,modal:!0}),$("#avatarImg").attr("src",e.imgurl+"?v="+Math.random()),"IE8"==myBrowser()||"IE9"==myBrowser()?$("#avaImgBox").hide():$("#avaImgBox2").hide(),$(".uerAvater").attr("src",e.imgurl+"?v="+Math.random()),addCookie("userImg",e.imgurl+"?v="+Math.random()),pdLogin())}function crop(){var e,o,a,i={imageBox:".imageBox",thumbBox:".thumbBox",spinner:".spinner",imgSrc:"../images/ava1.png"};document.querySelector("#fileInput").addEventListener("change",function(o){$("#btnCrop").removeClass("pick"),$(".imageBox").removeClass("initCrop");var a=this.files[0];if(1==checkSize(a,"")){var t=new FileReader;t.onload=function(o){i.imgSrc=o.target.result,e=new cropbox(i)},t.readAsDataURL(this.files[0]),this.files[0]=[]}}),document.querySelector("#btnCrop").addEventListener("click",function(){if(1==$(".imageBox").hasClass("initCrop")){i.imgSrc=$("#limPng").val(),a=new cropbox(i),console.log(a);t=a.getDataURL();$("#limPng").val(t),document.querySelector(".cropped").innerHTML='<img src="'+t+'">'}else if(0==$("#btnCrop").hasClass("pick")){t=e.getDataURL();$("#limPng").val(t),console.log(e),document.querySelector(".cropped").innerHTML='<img src="'+t+'">'}else{var t=o.getDataURL();$("#limPng").val(t),console.log(o),document.querySelector(".cropped").innerHTML='<img src="'+t+'">'}}),document.querySelector("#btnZoomIn").addEventListener("click",function(){1==$(".imageBox").hasClass("initCrop")?(i.imgSrc=$("#limPng").val(),(a=new cropbox(i)).zoomIn()):0==$("#btnCrop").hasClass("pick")?e.zoomIn():o.zoomIn()}),document.querySelector("#btnZoomOut").addEventListener("click",function(){1==$(".imageBox").hasClass("initCrop")?(i.imgSrc=$("#limPng").val(),(a=new cropbox(i)).zoomOut()):0==$("#btnCrop").hasClass("pick")?e.zoomOut():o.zoomOut()}),$("#confirmCamer").on("click",function(){if($(".imageBox").removeClass("initCrop"),$("#confirmCamer").hasClass("canClick")){var e=$.scriptcam.getFrameAsBase64();$(".limitBox .imageBox").css("background-image","url(data:image/png;base64,"+e+")"),$("#btnCrop").addClass("pick");var a={imageBox:".imageBox",thumbBox:".thumbBox",spinner:".spinner",imgSrc:"data:image/png;base64,"+e};o=new cropbox(a),$(this).parents(".alertBox").hide(),$("#confirmCamer").removeClass("canClick").addClass("disabled").attr("disabled","disabled").val("正在拍照..")}else M.dialog1=jqueryAlert({content:"请打开摄像头才能识别",closeTime:1e3,modal:!0})})}Path.map("#/mysort/plan").to(function(){$("#myUrl").load("modules/mysort/plan.html")}),Path.map("#/mysort/course").to(function(){$("#myUrl").load("modules/mysort/course.html")}),Path.map("#/mysort/test").to(function(){$("#myUrl").load("modules/mysort/test.html")}),Path.map("#/mysort/info").to(function(){$("#myUrl").load("modules/mysort/info.html")}),Path.map("#/mysort/safe").to(function(){$("#myUrl").load("modules/mysort/safe.html")}),Path.map("#/mysort/upload").to(function(){$("#myUrl").load("modules/mysort/upload.html")}),$(document).ready(function(){Path.listen()}),"IE8"!==myBrowser()&&"IE9"!==myBrowser()&&crop(),$(document).attr("title","个人中心_人人创培训监管服务平台");var M={};pdLogin(),pdUserLogin(),hashPick(),"4"==getCookie("userType")?($("#test").hide(),$("#tests").hide()):($("#test").show(),$("#tests").show()),"0"==getCookie("userCot")?$("#count").hide():($("#count").show(),$("#count").text(getCookie("userCot"))),$(".uerAvater").attr("src",getCookie("userImg")),$("#avatarImg").attr("src",getCookie("userImg")),$(".avat")&&$(".avat").find("img").attr("src",getCookie("userImg"));var com_obj=new Object;commonParm(com_obj),$('input[name="browser"]').val(com_obj.browser),$('input[name="device"]').val(com_obj.device),$('input[name="errCode"]').val(com_obj.errCode),$('input[name="token"]').val(com_obj.token),$('input[name="userId"]').val(com_obj.userId),$('input[name="userType"]').val(com_obj.userType),$('input[name="year"]').val(com_obj.curYear),getUminfo();var hash=window.location.hash;if("undefined"!==hash.split("/")[2]&&""!==hash.split("/")[2]&&void 0!==hash.split("/")[2])var hashJup=hash.split("/")[2];"plan"==hashJup?($(".colist li").eq(0).addClass("active"),$(".colist li").eq(0).siblings("li").removeClass("active")):"shoucang"==hashJup?($(".colist li").eq(1).addClass("active"),$(".colist li").eq(1).siblings("li").removeClass("active")):"test"==hashJup?($(".colist li").eq(2).addClass("active"),$(".colist li").eq(2).siblings("li").removeClass("active")):"info"==hashJup?($(".colist li").eq(3).addClass("active"),$(".colist li").eq(3).siblings("li").removeClass("active")):"safe"==hashJup?($(".colist li").eq(4).addClass("active"),$(".colist li").eq(4).siblings("li").removeClass("active")):"hike"==hashJup?($(".colist li").eq(5).addClass("active"),$(".colist li").eq(5).siblings("li").removeClass("active")):"about"==hashJup&&($(".aboutS li").eq(0).addClass("active"),$(".aboutS li").eq(0).siblings("li").removeClass("active")),$(".avatarBox").on("mouseover",function(){$(this).find(".avatHover").show(),hideAllTooltips()}),$(".avatarBox").on("mouseleave",function(){$(this).find(".avatHover").hide(),hideAllTooltips()}),$(".avatHover").on("click",function(){$(".avatHover").show();var e=$(this).next().attr("src");$(".avat img").attr("src",e),"IE8"==myBrowser()||"IE9"==myBrowser()?$("#avaImgBox").show():$("#avaImgBox2").show()}),$("#imgConfim").on("click",function(){if("IE8"==myBrowser()||"IE9"==myBrowser()){var e=uuid(),o=new Object;uploaAva(e),o.key=e,commonParm(o),setTimeout(function(){jsonAjax(InterFace.getImgURL,o,getAvaFunc)},1e3),setTimeout(function(){var e=new Object,o=$("#imgUrl").val();e.imgUrl=o,commonParm(e),jsonAjax(InterFace.getAvaIe,e,changeAva_fn)},2e3)}else{var a=new Object,i=$(".avat").find("img").attr("src"),t=$("#imgStr").val(),n=i.split(",")[1];a.imgStr=t,a.base64Img=n,commonParm(a),console.log(a),jsonAjax(InterFace.editImg,a,changeAva_fn)}}),$("#imgCancel").on("click",function(){$(this).parents(".alertBox").hide()}),$(".colist").find("li").on("click",function(){$(this).addClass("active").siblings(".colist li").removeClass("active");var e=$(this).index(".colist li");$(".perBox").eq(e).show().siblings(".perBox").hide()}),$(".camPick").unbind("click").bind("click",function(){$("#pickImgBox").show(),$("#webcam").scriptcam({width:320,height:290,showMicrophoneErrors:!0,onError:function(e,o){3==e&&(M.dialog1=jqueryAlert({content:"无法检测到摄像头，请检查",closeTime:1e3,modal:!0})),4==e&&$("#camerBox").hide()},cornerRadius:0,cornerColor:"e3e5e2",connected:function(e){console.log(e)},onWebcamReady:function(e,o,a,i,t){$("#confirmCamer").addClass("canClick")},onMotion:function(e){console.log(e)},onPictureAsBase64:function(e){}})}),$("#pickImgBox .closed").on("click",function(){$(this).parents(".alertBox").hide()}),$("#avaImgBox .closed").on("click",function(){$(this).parents(".alertBox").hide()}),$("#avaImgBox2 .closed").on("click",function(){$(this).parents(".alertBox").hide()}),$("#limitConfim").on("click",function(){var e=$("#limPng").val();if(""==e)M.dialog1=jqueryAlert({content:"请选择要更换截取的图片",closeTime:1e3,modal:!0});else{var o=new Object,a=e.split(",")[1];o.imgStr="png",o.base64Img=a,commonParm(o),console.log(o),jsonAjax(InterFace.editImg,o,changeAva_fn)}});