function askOrder(){var e=new Object;e.orderCode=getSearch("no"),commonParm(e),jsonAjax(InterFace.getOrderInfo,e,queryOrderFn)}function queryOrderFn(e){if(console.log(e),"200"==e.errCode){var o=Number(e.orderAmount).toFixed(2);$("#orderAmount").text(o),$("#orderAs").val(o),$("#payStatus").val(e.orderStatus);var r="";$.each(e.list,function(e,o){if(o.coursewareMinUrl)t=o.coursewareMinUrl;else var t=o.coursewareurl;var a=Number(o.money).toFixed(2);r+='<div class="item clearfix js-item-cart"><div class="item-2 clearfix"><a href="lessonInfo_fee.html?id='+o.coursewareid+'" target="_blank" class="img-box l"><img src="'+t+'" width="160" height="90"></a><dl class="l has-package"><a href="lessonInfo_fee.html?id='+o.coursewareId+'" target="_blank"><dt class="coursewareName">'+o.coursewarename+'</dt></a><p class="package-item js-package-item"></p></dl></div><div class="item-3"><div class="price clearfix"> <em>￥</em><span>'+a+"</span></div></div></div>"}),$("#js-cart-body-table .js-itemUl").html(r),loadig.hide("loadOrder")}}function askStatus(){var e=new Object;e.orderCode=getSearch("no"),commonParm(e),jsonAjax(InterFace.getOrderInfo,e,queryStusFn)}function queryStusFn(e){console.log(e),"200"==e.errCode&&("2"==e.orderStatus?(M.dialog1=jqueryAlert({content:"该订单已成功支付！",closeTime:1e3,modal:!0}),setTimeout(function(){window.location.href="myOrder.html#/order/order"},1e3)):"5"==e.orderStatus&&(M.dialog1=jqueryAlert({content:"该订单已关闭",closeTime:1e3,modal:!0}),setTimeout(function(){window.location.href="myOrder.html#/order/order"},1e3)))}function wxFn(e){console.log(e),"200"==e.errCode&&($(".js-qrcode-img img").attr("src","data:image/png;base64,"+e.codeUrl),$("#wxPrice").text(e.orderAmount),$("#wxPay").show(),$(".payshadow").show(),qyeryLun=setInterval(function(){askStatus()},1e4))}function alipayFn(e){console.log(e),"200"==e.errCode&&($("#aliPay").show(),$(".payshadow").show(),myWindow=window.open("","target",""),myWindow.document.write(e.form),myWindow.document.charset="gb2312")}var qyeryLun,M={};askOrder(),loadig.load("loadOrder",1,"正在加载，请稍后..."),$(".trade-title .num").text(getSearch("no")),$(".js-toggle-detai").on("click",function(){$(".cart-body .item-ul").toggle()}),$(".js-modal-close").on("click",function(){$(this).parents(".moco-modal-layer").hide(),clearInterval("qyeryLun"),$(".payshadow").hide()}),$(".js-restart-btn").on("click",function(){$(this).parents(".moco-modal-layer").hide(),$(".payshadow").hide()}),$(".js-pay-method li").on("click",function(){$(this).addClass("active").siblings("li").removeClass("active")}),$(".js-pay-submit").on("click",function(){var e=$(".js-pay-method").find("li.active").attr("data-type");if("1"==e)(o=new Object).orderCode=getSearch("no"),commonParm(o),jsonAjax(InterFace.getOrderInfo,o,function(e){if("200"==e.errCode)if("2"==e.orderStatus)M.dialog1=jqueryAlert({content:"该订单已成功支付！",closeTime:1e3,modal:!0}),setTimeout(function(){window.location.href="myOrder.html#/order/order"},1e3);else if("5"==e.orderStatus)M.dialog1=jqueryAlert({content:"该订单已关闭",closeTime:1e3,modal:!0}),setTimeout(function(){window.location.href="myOrder.html#/order/order"},1e3);else{clearInterval("qyeryLun");var o=new Object;o.orderAmount=$("#orderAs").val(),o.orderCode=getSearch("no"),commonParm(o),console.log(o),jsonAjax(InterFace.alipay,o,alipayFn)}});else if("2"==e){var o=new Object;o.orderCode=getSearch("no"),commonParm(o),console.log(o),jsonAjax(InterFace.getOrderInfo,o,function(e){if(console.log(e),"200"==e.errCode)if("2"==e.orderStatus)M.dialog1=jqueryAlert({content:"该订单已成功支付！",closeTime:1e3,modal:!0}),setTimeout(function(){window.location.href="myOrder.html#/order/order"},1e3);else if("5"==e.orderStatus)M.dialog1=jqueryAlert({content:"该订单已关闭",closeTime:1e3,modal:!0}),setTimeout(function(){window.location.href="myOrder.html#/order/order"},1e3);else{var o=new Object;o.orderAmount="0.01",o.orderCode=getSearch("no"),commonParm(o),console.log(o),jsonAjax(InterFace.wxPay,o,wxFn)}})}}),$(".js-success-btn").on("click",function(){var e=new Object;e.orderCode=getSearch("no"),commonParm(e),jsonAjax(InterFace.getOrderInfo,e,function(e){"200"==e.errCode&&("2"==e.orderStatus?($("#aliPay").hide(),$(".js-error").text("该订单已成功支付！"),setTimeout(function(){window.location.href="myOrder.html#/order/order"},1e3)):"5"==e.orderStatus&&($(".js-error").text("该订单已关闭！"),setTimeout(function(){window.location.href="myOrder.html#/order/order"},1e3)))})});