function resizeIntro(){var e=$("#introH").height(),o=$("#introH").text(),t=o.substring(0,100),n=o.substring(0,60);e>159&&$("#introH").text(t+"..."),e>186&&$("#introH").text(n+"...")}function studyStates(){var e=new Object;e.coursewareId=getSearch("id"),commonParm(e),jsonAjax(InterFace.getLearnType,e,getStudyStates)}function commetList(e,o){jsonAjax(InterFace.commetList,itemParm,function(t){"200"==t.errCode?($(".other_pub .prepend").remove(),avalon.vmodels.lessonInfo.commetList=t.comments):"306"==t.errCode&&$(".nodata").css("display","block"),e.addClass("active").siblings(".lessTab li").removeClass("active"),$(".lesConlist").eq(o).addClass("show").siblings(".lesConlist").removeClass("show")})}function getItem_fn(e){"200"==e.errCode&&""!==e.crCourseware.chapterList&&e.crCourseware.chapterList.length>0&&(avalon.vmodels.lessonInfo.itemList=e.crCourseware.chapterList),loadig.hide("planLoad")}function getLearn_fn(e){if(console.log(e),"200"==e.errCode){var o="",t=getSearch("id");o="IE8"==myBrowser()||"IE9"==myBrowser()?"videoIe.html?pid="+t+"&cid="+e.courseId+"&vid="+e.url:"video.html?pid="+t+"&cid="+e.courseId+"&vid="+e.url,$(".goBtn").on("click",function(){""==getCookie("token")||null==getCookie("token")||"undefined"==getCookie("token")?(M.dialog1=jqueryAlert({content:"您还未登录，即将跳到登录界面",closeTime:1e3,modal:!0}),setTimeout(function(){window.location.href="login.html"},1e3)):window.location.href=o})}else $(".goBtn").on("click",function(){""!=getCookie("token")&&null!=getCookie("token")&&"undefined"!=getCookie("token")||(M.dialog1=jqueryAlert({content:"您还未登录，即将跳到登录界面",closeTime:1e3,modal:!0}),setTimeout(function(){window.location.href="login.html"},1e3))})}function tui_fn(e){if("200"==e.errCode){var o="";$.each(e.courseList,function(e,t){if(t.introduce.length>60)n=t.introduce.substring(0,60)+"...";else var n=t.introduce;o+='<li class="clearfix"><a class="sugest_l fl" href="lessoninfo.html?id='+t.coursewareId+'" target="_blank"><img src="'+t.coursewareurl+version+'" alt=""></a><div class="sugest_r fr"><p class="tir"><a href="lessoninfo.html?id='+t.coursewareId+'" target="_blank">'+t.coursewarename+'</a></p><p class="con">'+n+'</p></div><p class="study_show"><span><i class="iconfont icon-yanjing"></i><i>'+t.coursewarepv+'</i></span><span class="fr"><i class="iconfont icon-xing"></i><i>评分</i><em>'+t.coursewarescore+"</em></span></p></li>"}),$("#foUsugg").html(o)}}function commetAdd_fn(e){if("200"==e.errCode){var o,t,n=$.myTime.UnixToDate(e.commentdate,!0);o=""==e.imgurl||null==e.imgurl||"null"==e.imgurl?"images/ava1.png":e.imgurl,t=""==e.nickName||null==e.nickName||"null"==e.nickName?"未设置":e.nickName;var r='<div class="publist clearfix prepend"><div class="innerBox clearfix"><a class="user-head fl"><img src="'+o+version+'" ></a><div class="user-r fl"><h4><i>'+t+" </i><span>评分<em>"+e.coursescore+'</em></span><span class="fr time">'+n+"</span></h4><p>"+e.commentcontent+"</p></div></div></div>";$(".nodata").hide(),$(".other_pub").prepend(r),$("#comment").val("")}else"513"==e.errCode?M.dialog1=jqueryAlert({content:"评价中含敏感字，请注意",closeTime:1e3,modal:!0}):"304"==e.errCode&&(M.dialog1=jqueryAlert({content:"登录之后才能评价",closeTime:1e3,modal:!0}))}function getLeson_info(e){if("200"==e.errCode){if($("#mainTeach").text(e.teachername),$("#p_scor").text(e.coursewarescore),$("#p_col").text(e.coursewarecollect),$("#p_pv").text(e.coursewarepv),$(".curName").text(e.coursewarename),$("#curl").attr("src",e.coursewareurl),$("#corHour").text(millsTrans(e.coursewaredate)),window.screen.width<=1680)o=e.introduce.substring(0,50)+"...";else if(e.introduce.length>70)o=e.introduce.substring(0,70)+"...";else var o=e.introduce;$("#introH").text(o),$(document).attr("title",e.coursewarename+"_人人创培训监管服务平台")}else if("306"==e.errCode){loadig.hide("planLoad"),M.dialog1=jqueryAlert({content:"该课件不存在或被删除",closeTime:1e3,modal:!0});var t=setTimeout(function(){window.location.href="lesson.html",clearTimeout(t)},1e3)}}function getStudyStates(e){"200"==e.errCode&&(1==e.flag?$(".goBtn").removeClass("on").text("继续学习"):$(".goBtn").addClass("on").text("开始学习"))}function getTeachInfo(e){if("200"==e.errCode){if(""==e.tricon||null==e.tricon||"null"==e.tricon||"undefined"==e.tricon)o="images/xzx.jpg";else var o=e.tricon;$("#teacher_intro img").attr("src",o),$("#teacher_intro h5").text(e.trname),$("#teacher_intro p").text(e.trabstract)}}function getColecType(e){console.log(e),"200"==e.errCode&&(avalon.vmodels.lessonInfo.collectType=e.collectionType)}function cancelColecType(e){"304"==e.errCode||"200"==e.errCode&&(avalon.vmodels.lessonInfo.collectType=2)}function addColecType(e){"304"==e.errCode||"200"==e.errCode&&(avalon.vmodels.lessonInfo.collectType=1)}jQuery.support.cors=!0,loadig.load("planLoad",1,"正在加载中，请稍后..."),studyStates();var version=getVersion(),M={},courseId=getSearch("id"),com_obj=new Object;commonParm(com_obj);var lessonInfo=avalon.define({$id:"lessonInfo",sortList:{},itemList:{},commetList:{},teaherInfo:{},tuiList:{},countRows:"",hasUser:!1,toFlag:!1,collectType:!1,toVideo:function(e,o,t){""==getCookie("token")||null==getCookie("token")||"undefined"==getCookie("token")?(M.dialog1=jqueryAlert({content:"您还未登录，即将跳到登录界面",closeTime:1e3,modal:!0}),setTimeout(function(){window.location.href="login.html"},1e3)):"IE8"==myBrowser()||"IE9"==myBrowser()?window.location.href="videoIe.html?pid="+e+"&cid="+o+"&vid="+t:window.location.href="video.html?pid="+e+"&cid="+o+"&vid="+t},toggleShow:function(e){$(e).parent("li").next("ul").toggle(),$(e).find(".iconfont").toggleClass("icon-spread-up"),$(e).find(".iconfont").hasClass("icon-spread-up")?$(e).find("em").eq(0).text("展开"):$(e).find("em").eq(0).text("收起")}});void 0!==getCookie("userId")||""!==getCookie("userId")||null!==getCookie("userId")?(avalon.vmodels.lessonInfo.hasUser=!0,void 0===getCookie("userImg")&&""===getCookie("userImg")&&null===getCookie("userImg")||$(".uerAvater").attr("src",getCookie("userImg"))):($(".uerAvater").attr("src","images/ava1.png"+version),avalon.vmodels.lessonInfo.hasUser=!1);var course_obj=new Object;course_obj.coursewareId=getSearch("id"),commonParm(course_obj),jsonAjax(InterFace.listInfo,course_obj,getLeson_info),$(window).on("resize",function(){resizeIntro()}),jsonAjax(InterFace.askTeacher,course_obj,getTeachInfo),console.log(course_obj),jsonAjax(InterFace.askCollect,course_obj,getColecType),$("#cancelsc").on("click",function(){jsonAjax(InterFace.qxcol,course_obj,cancelColecType)}),$("#sc").on("click",function(){void 0==getCookie("token")||""==getCookie("token")||null==getCookie("token")?M.dialog1=jqueryAlert({content:"您还没登录不能收藏课程，请到登录界面登录",closeTime:1e3,modal:!0}):jsonAjax(InterFace.collection,course_obj,addColecType)});var itemParm=new Object;itemParm.coursewareId=getSearch("id"),itemParm.page=1,itemParm.rows=7,commonParm(itemParm),jsonAjax(InterFace.lessonItem,itemParm,getItem_fn),$(".publishBtn").on("click",function(){if(void 0!==getCookie("userId")&&"undefined"!==getCookie("userId")&&""!==getCookie("userId")&&null!==getCookie("userId"))if($.trim($("#comment").val()).length<1)M.dialog1=jqueryAlert({content:"请输入评论内容",closeTime:1e3,modal:!0});else{var e=Number($(".function-hint").text()),o=getSearch("id"),t=$("#comment").val(),n=new Object;n.coursewareid=o,n.coursescore=e,n.commentcontent=t,commonParm(n),console.log(n),jsonAjax(InterFace.commetAdd,n,commetAdd_fn)}else M.dialog1=jqueryAlert({content:"您还没登录，不能发表评论",closeTime:1e3,modal:!0})});var courType2=new Object;courType2.count=3,courType2.type=2,commonParm(courType2),jsonAjax(InterFace.courseList,courType2,tui_fn);var sty_obj=new Object;sty_obj.coursewareId=getSearch("id"),commonParm(sty_obj),console.log(getCookie("userType")),"3"!=getCookie("userType")&&"4"!=getCookie("userType")||(console.log(sty_obj),jsonAjax(InterFace.studyId,sty_obj,getLearn_fn)),avalon.filters.FM=function(e){var o=parseInt(e)+"秒";if(parseInt(e)>60){var t=parseInt(e)%60,n=parseInt(e/60);if(o=n+"分"+t+"秒",n>=60){n=parseInt(e/60)%60;var r=parseInt(parseInt(e/60)/60);o=r+"小时"+n+"分"+t+"秒",r>24&&(r=parseInt(parseInt(e/60)/60)%24,o=parseInt(parseInt(parseInt(e/60)/60)/24)+"天"+r+"小时"+n+"分"+t+"秒")}}return"null"!=e&&null!=e&&"undefined"!=e||(o="0秒"),o},avalon.filters.UnixToDate=function(e){var o=new Date(e),t="";return t+=o.getUTCFullYear()+".",t+=o.getUTCMonth()+1+".",t+=o.getUTCDate(),t+=" "+o.getHours()+":",t+=("0"+o.getMinutes()).slice(-2)+":",t+=("0"+o.getSeconds()).slice(-2)},avalon.scan(),$(".lessTab").find("li").on("click",function(){var e=$(this).index(".lessTab li"),o=$(".lessTab li").eq(1);"1"==e?commetList(o,e):($(this).addClass("active").siblings(".lessTab li").removeClass("active"),$(".lesConlist").eq(e).addClass("show").siblings(".lesConlist").removeClass("show"))}),$(".star").raty({number:5,targetType:"number",path:"images",size:24,starHalf:"star_half.png",starOff:"star_off.png",starOn:"star_on.png",half:!0,halfShow:!0,hints:[2,4,6,8,10],score:2.5,click:function(e,o){var e=e;$(".function-hint").text(2*e)}});