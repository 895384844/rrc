function item(){var e=new Object;e.coursewareId=getSearch("pid"),e.page=0,e.row=0,commonParm(e),jsonAjax(InterFace.lessonItem,e,lessItem_fn)}function scriptcam_getImg(e,a){var r=a,o=new Object;o.coursewareId=coursewareId,o.coursewarename=chapterName,o.base64img=r,o.base64imgSuffix="png",o.courseId=getSearch("cid"),o.coursename=coursename,o.scheduletime=e,o.systemname=detectOS(),commonParm(o),jsonAjax(InterFace.captureM,o,capture_fn)}function updateVideoRate(e){var a=new Object;a.courseId=getSearch("cid"),a.learnTime=e,commonParm(a),jsonAjax(InterFace.updateVideoRate,a)}function askVideoUrl(){var e=new Object;e.videoId=getSearch("vid"),commonParm(e),jsonAjax(InterFace.videoUrl,e,videoUrl)}function initPlayer(e){if("4"==getCookie("userType")){(player="IE8"==myBrowser()||"IE9"==myBrowser()?new prismplayer({id:"J_prismPlayer",source:e,autoplay:!0,cover:"",width:"100%",height:gapH,controlBarVisibility:"always"}):new Aliplayer({id:"J_prismPlayer",source:e,autoplay:!0,cover:"",width:"100%",height:gapH,controlBarVisibility:"always"})).on("ready",function(){void 0!==playTime&&"undefined"!==playTime&&zongTime-playTime>5&&player.seek(playTime)}),player.on("play",function(){r=window.setInterval(function(){updateVideoRate(player.getCurrentTime())},1e4)}),player.on("pause",function(){window.clearInterval(r)}),player.on("ended",function(){window.clearInterval(r);var e=new Object;e.learnTime=player.getCurrentTime(),e.learnType=1,e.courseId=getSearch("cid"),commonParm(e),jsonAjax(InterFace.updateLearnRate,e),$("#tipSucc").show(),$("#zheng").removeClass("nogreen").addClass("default").text("已完成"),$("#zheng").parent("li").find(".iconfont").removeClass("colgreen").addClass("colred")})}else if("3"==getCookie("userType")){var a,r;(player="IE8"==myBrowser()||"IE9"==myBrowser()?new prismplayer({id:"J_prismPlayer",source:e,autoplay:!1,cover:"",width:"100%",height:gapH,controlBarVisibility:"always"}):new Aliplayer({id:"J_prismPlayer",source:e,autoplay:!1,cover:"",width:"100%",height:gapH,controlBarVisibility:"always"})).on("ready",function(){void 0!==playTime&&"undefined"!==playTime&&zongTime-playTime>5&&player.seek(playTime)}),player.on("play",function(){var e;0==flag?($("#camerBoxs").show(),$("#camerBoxs").css({width:"100%"}),$("#webcam").css("width","100%"),$("#camerBoxs .alertCon").css("width","380px"),$("#bgarea").hasClass("hasPlay"),player.pause()):1==flag&&($("#bgarea").addClass("hasPlay"),a=window.setInterval(function(){var r=$.scriptcam.getFrameAsBase64();if(r==e)player.pause(),M.dialog1=jqueryAlert({content:"无法检测到摄像头，请检查",closeTime:1e3,modal:!0}),window.clearInterval(a);else{var o=player.getCurrentTime();e=r,scriptcam_getImg(o,r)}},3e5),r=window.setInterval(function(){updateVideoRate(player.getCurrentTime())},1e4))}),player.on("ended",function(){window.clearInterval(a),window.clearInterval(r);var e=new Object;e.learnTime=player.getCurrentTime(),e.learnType=1,e.courseId=getSearch("cid"),commonParm(e),jsonAjax(InterFace.updateLearnRate,e),$("#tipSucc").show(),$("#zheng").removeClass("nogreen").addClass("default").text("已完成"),$("#zheng").parent("li").find(".iconfont").removeClass("colgreen").addClass("colred")}),player.on("pause",function(){window.clearInterval(a),window.clearInterval(r),flag=!1})}}function showPlay(){}function alertTip(){M.dialog1=jqueryAlert({content:"允许打开摄像头才能上课",closeTime:1e3,modal:!0})}function base64_tofield_and_image(e){}function motionCamera(e,a,r,o,t){}function onError(e,a){3==e&&(M.dialog1=jqueryAlert({content:"没有检测到可用的网络摄像头",closeTime:1e3,modal:!0})),4==e&&(player.stop(),alertTip(),$("#camerBoxs").hide(),$("#camerBoxs").css({width:"0"}),$("#webcam").css("width","0%"),$("#camerBoxs .alertCon").css("width","0%"),flag=!1)}function onWebcamReady(e,a,r,o,t){$("#confirmCamer").addClass("canClick")}function initViImg(){var e=$.scriptcam.getFrameAsBase64(),a=new Object;a.coursewareId=coursewareId,a.coursewarename=chapterName,a.base64img=e,a.base64imgSuffix="png",a.courseId=getSearch("cid"),a.coursename=coursename,a.scheduletime=0,a.systemname=detectOS(),commonParm(a),console.log(a),jsonAjax(InterFace.captureM,a,initViImg_fn)}function initViImg_fn(e){console.log(e),"200"==e.errCode?(M.dialog1=jqueryAlert({content:"人脸比对成功",closeTime:1e3,modal:!0}),$("#camerBoxs").css({width:"0"}),$("#webcam").css("width","0%"),$("#camerBoxs .alertCon").css("width","0%"),flag=!0,$("#confirmCamer").removeClass("disabled").removeAttr("disabled").val("确定"),player.play()):"331"==e.errCode?(M.dialog1=jqueryAlert({content:"未采集到人脸,请重新调整",closeTime:1e3,modal:!0}),flag=!1,$("#confirmCamer").removeClass("disabled").removeAttr("disabled").val("确定")):"332"==e.errCode?(M.dialog1=jqueryAlert({content:"人脸比对失败,请重新调整",closeTime:1e3,modal:!0}),flag=!1,$("#confirmCamer").removeClass("disabled").removeAttr("disabled").val("确定")):"333"==e.errCode&&(M.dialog1=jqueryAlert({content:"人脸认证失败,即将跳往个人信息页认证",closeTime:1e3,modal:!0}),flag=!1,$("#confirmCamer").removeClass("disabled").removeAttr("disabled").val("确定"),setTimeout(function(){window.location.href="my.html#/mysort/info"},1e3))}function lessItem_fn(e){if("200"==e.errCode){chapterName=e.crCourseware.coursewarename,coursewareId=e.crCourseware.coursewareId,$("#chapterName").text(chapterName);var a="";$.each(e.crCourseware.chapterList,function(e,r){a+='<div class="itemList"><li><span>'+r.chaptername+"</span></li><ul>",$.each(r.courseList,function(e,r){r.courseId==getSearch("cid")&&(coursename=r.coursename,playTime=r.learnTime,zongTime=r.coursedate),a+='<li pid="'+r.coursewareId+'" cid="'+r.courseId+'" vid="'+r.courseaddr+'">',"1"==r.learnType?a+='<i class="iconfont icon-dot colred"></i>':a+='<i class="iconfont icon-dot colgreen"></i>';var o=millsTrans(r.coursedate);a+="<span>"+r.coursename+"</span> <em>"+o+"</em>","1"==r.learnType&&r.courseId!==curItem?a+='<a class="usualBtn statusBtn default" >已完成</a>':"1"==r.learnType&&r.courseId==curItem&&(a+='<a class="usualBtn statusBtn nogreen" id="zheng">正在学习</a>'),"2"==r.learnType&&r.courseId!==curItem?a+='<a class="usualBtn statusBtn active">继续学习</a>':"2"==r.learnType&&r.courseId==curItem&&(a+='<a class="usualBtn statusBtn nogreen" id="zheng">正在学习</a>'),"3"==r.learnType&&r.courseId!==curItem?a+='<a class="usualBtn statusBtn green">开始学习</a>':"3"==r.learnType&&r.courseId==curItem&&(a+='<a class="usualBtn statusBtn nogreen" id="zheng">正在学习</a>'),a+="</li>"}),a+="</ul></div>"}),$("#ock_con").html(a),$(document).attr("title",coursename),loadig.hide("planLoad"),$("#ock_con li").on("click",function(){var e=$(this).attr("pid"),a=$(this).attr("cid"),r=$(this).attr("vid");"IE8"==myBrowser()||"IE9"==myBrowser()?window.location.href="videoIe.html?pid="+e+"&cid="+a+"&vid="+r:window.location.href="video.html?pid="+e+"&cid="+a+"&vid="+r})}}function capture_fn(e){"200"==e.errCode?flag=!0:"331"==e.errCode?(M.dialog1=jqueryAlert({content:"未采集到人脸,请重新调整",closeTime:1e3,modal:!0}),player.pause(),flag=!1):"332"==e.errCode&&(M.dialog1=jqueryAlert({content:"人脸比对失败,请重新调整",closeTime:1e3,modal:!0}),player.pause(),flag=!1)}var M={},hasUpdate="false",curItem=getSearch("cid"),chapterName,coursewareId,coursename,playTime,zongTime,player,winW=$(window).width(),winH=$(window).height(),hearH=$(".header").height(),selistW=$(".section-list").width(),gapW=winW-selistW+"px",gapH=winH-hearH+"px";pdLogin(),alertHide(),pdCount(),item(),hikeLearn(),loadig.load("planLoad",1,"正在加载中，请稍后..."),$(".cancel").on("click",function(){$(this).parents(".tipFm").hide()}),$(".uerAvater").attr("src",getCookie("userImg"));var anflag=!1,flag=!1;$(".js-box-wrap").height(gapH),$(window).on("resize",function(){$(".js-box-wrap").height(e);$(".section-list").width();var e=winH-hearH+"px"}),$(document).attr("title","课程_人人创培训监管服务平台"),$("#opItem").on("click",function(){var e=$(".section-list").width(),a=winW-e+"px";0==anflag?($(".js-box-wrap").animate({width:a}),$(".section-list").animate({right:"0"}),anflag=!0):($(".js-box-wrap").animate({width:"100%"}),$(".section-list").animate({right:"-"+e}),anflag=!1)}),$(".back_l").on("click",function(){window.location.href="lessoninfo.html?id="+getSearch("pid")}),"3"==getCookie("userType")?($("#camerBoxs").show(),$("#camerBoxs .alertCon").css("width","380px")):($("#camerBoxs").hide(),$("#camerBoxs").css("width","0%"),$("#webcam").css("width","0%"),$("#camerBoxs .alertCon").css("width","0%"));var vedioId=getSearch("vid");initPlayer(vedioId),"3"==getCookie("userType")&&($("#webcam").scriptcam({height:280,showMicrophoneErrors:!1,onError:onError,cornerRadius:0,cornerColor:"e3e5e2",connected:showPlay,onWebcamReady:onWebcamReady,onPictureAsBase64:base64_tofield_and_image,onMotion:motionCamera}),$(function(){$("#confirmCamer").on("click",function(){$(this).hasClass("canClick")&&(initViImg(),$("#confirmCamer").addClass("disabled").attr("disabled","disabled").val("正在识别.."))})}),$("#ock").perfectScrollbar());