function submitTest(){var e=new Object;e.questionList=questionList,e.testpaperId=testId;var t=new Date(starTime),a=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();e.startTime=a,commonParm(e),jsonAjax(InterFace.submitPaper,e,submit_fn)}function toTest(){var e=new Object;e.testpaperId=testId,commonParm(e),jsonAjax(InterFace.getTestVal,e,test_fn)}function test_fn(e){"200"==e.errCode?($("#testResult").removeClass("disabled").removeAttr("disabled").val("确定"),addCookie("achievement",e.achievement,0),window.location.href="test.html?type=0"):"507"==e.errCode&&($("#testResult").removeClass("disabled").removeAttr("disabled").val("确定"),window.location.href="test.html?type=1")}function submit_fn(e){"200"==e.errCode?setTimeout(function(){toTest()},2e3):"507"==e.errCode&&($("#testResult").removeClass("disabled").removeAttr("disabled").val("确定"),window.location.href="test.html?type=1")}function getXz_fn(e){"200"==e.errCode?($("#textTit").text(e.paperExplain),$("#testSum").text(e.score),testId=e.testpaperId,testName=e.paperExplain,zongLength=e.list.length,$.each(e.list,function(e,t){var a=' <ul><div class="exam_qwe"><em>'+(e+1)+"、</em><span>"+t.topicstem;"1"==t.topictype?a+="<em>（单选）</em>":2==t.topictype&&(a+="<em>（多选）</em>"),a+='</span></div><div class="exam_answ" >',$.each(t.topicOptions,function(e,s){"1"==t.topictype?a+='<li class="col-lg-3 col-md-3 col-sm-12"><label><input type="radio" name="'+t.crpapertopicId+'"value="'+s.option+'"><img src="images/uncheck.png" class="b1" disabled=""><img src="images/check.png" class="b2"><i>'+s.option+"、"+s.content+"</i></label></li>":a+='<li class="col-lg-3 col-md-3 col-sm-12"><label><input type="checkbox" name="'+t.crpapertopicId+'"value="'+s.option+'"><img src="images/checkb.png" class="b1" disabled=""><img src="images/check1.png" class="b2"><i>'+s.option+"、"+s.content+"</i></label></li>"}),a+="</div></ul>",$("#examCon").append(a)}),$("input").customInput()):"510"==e.errCode?(M.dialog1=jqueryAlert({content:"该计划没有试卷",closeTime:1e3,modal:!0}),window.location.href="my.html#/mysort/plan"):"509"==e.errCode&&(M.dialog1=jqueryAlert({content:"该计划没有试卷",closeTime:1e3,modal:!0}),window.location.href="my.html#/mysort/plan")}function alertTip(){M.dialog1=jqueryAlert({content:"允许打开摄像头才能考试",closeTime:1e3,modal:!0})}function base64_tofield_and_image(e){}function motionCamera(e,t,a,s,i){}function onError(e,t){3==e&&(M.dialog1=jqueryAlert({content:"没有检测到可用的网络摄像头",closeTime:1e3,modal:!0}))}function onWebcamReady(e,t,a,s,i){$("#confirmCamer").addClass("canClick")}function scriptcam_getImg(e){var t=e,a=new Object;a.crtestpaperId=testId,a.paperexplain=testName,a.base64img=t,a.base64imgSuffix="png",a.systemname=detectOS(),commonParm(a),jsonAjax(InterFace.examCaputer,a,capture_fn)}function capture_fn(e){"200"==e.errCode?($("#confirmCamer").hasClass("subs")&&(M.dialog1=jqueryAlert({content:"人脸比对成功",closeTime:1e3,modal:!0})),"1"==$("#intFirst").val()&&(M.dialog1=jqueryAlert({content:"人脸比对成功",closeTime:1e3,modal:!0}),$("#intFirst").val("0")),"1"==$("#intBool").val()&&(starTime=new Date,wacthActive=window.setInterval(function(){scriptcam_getImg($.scriptcam.getFrameAsBase64())},1e4)),$("#camerBoxs").css({width:"0"}),$("#webcam").css("width","0%"),$("#camerBoxs .alertCon").css("width","0%"),$("#intBool").val(0),$("#confirmCamer").removeClass("disabled").removeAttr("disabled").val("确定"),$("#confirmCamer").hasClass("subs")&&(flag=!0,1==testFlag&&(window.clearInterval(wacthActive),$("#testResult").addClass("disabled").attr("disabled","disabled").val("正在提交.."),submitTest()))):"331"==e.errCode?(M.dialog1=jqueryAlert({content:"未采集到人脸,请重新调整",closeTime:1e3,modal:!0}),flag=!1,$("#confirmCamer").removeClass("disabled").removeAttr("disabled").val("确定"),$("#camerBoxs").css({width:"100%"}),$("#webcam").css("width","100%"),$("#camerBoxs .alertCon").css("width","380px"),window.clearInterval(wacthActive),$("#intBool").val(1)):"332"==e.errCode?(M.dialog1=jqueryAlert({content:"人脸比对失败,请重新调整",closeTime:1e3,modal:!0}),flag=!1,$("#confirmCamer").removeClass("disabled").removeAttr("disabled").val("确定"),$("#camerBoxs").css({width:"100%"}),$("#webcam").css("width","100%"),$("#camerBoxs .alertCon").css("width","380px"),window.clearInterval(wacthActive),$("#intBool").val(1)):"333"==e.errCode&&(M.dialog1=jqueryAlert({content:"人脸认证失败,即将跳往个人信息页认证",closeTime:1e3,modal:!0}),flag=!1,window.clearInterval(wacthActive),window.location.href="my.html#/mysort/info")}var M={},enterpriseId=getSearch("id"),years=getSearch("years"),examParm=new Object;examParm.enterpriseId=enterpriseId,examParm.years=years,commonParm(examParm);var testId,testName,starTime,endTime,captureImg,zongLength,oldImg="",flag=!1,testFlag=!1;$(document).attr("title","考试_人人创培训监管服务平台"),alertHide(),pdLogin(),pdUserLogin(),jsonAjax(InterFace.getPaper,examParm,getXz_fn);var wacthActive,questionList=[];$("#testResult").on("click",function(){if($("#testResult").hasClass("disabled"))return!1;$(".exam_answ").each(function(e,t){var a="",s=new Object,i=$(this).find(".checked");if(i.length<1)return testFlag=!1,!1;if($(this).find(".erset").hasClass("custom-radio")){var o=$(this).find(".checked input").val(),n=$(this).find(".checked input").attr("name");s.answer=o,s.questionId=n}else if($(this).find(".erset").hasClass("custom-checkbox")&&i.length>0)if(i.length>1){for(var r=0;r<$(this).find(".checked").length;r++)a+=$(this).find(".checked").eq(r).find("input").val();s.answer=a;n=$(this).find(".checked input").attr("name");s.questionId=n}else{n=$(this).find(".checked input").attr("name");s.questionId=n,s.answer=$(this).find(".checked input").val()}testFlag=!0,questionList.push(s)}),1==testFlag&&0==flag?(window.clearInterval(wacthActive),$("#camerBoxs").show(),$("#camerBoxs").css({width:"100%"}),$("#webcam").css("width","100%"),$("#camerBoxs .alertCon").css("width","380px"),$("#confirmCamer").addClass("subs")):0==testFlag&&(M.dialog1=jqueryAlert({content:"请选择考试答案",closeTime:1e3,modal:!0}))}),$("#webcam").scriptcam({showMicrophoneErrors:!1,onError:onError,cornerRadius:0,cornerColor:"e3e5e2",onWebcamReady:onWebcamReady,onPictureAsBase64:base64_tofield_and_image,onMotion:motionCamera}),$("#confirmCamer").on("click",function(){$("#confirmCamer").hasClass("canClick")?(scriptcam_getImg($.scriptcam.getFrameAsBase64()),$("#confirmCamer").addClass("disabled").attr("disabled","disabled").val("正在识别..")):M.dialog1=jqueryAlert({content:"请打开摄像头才能识别",closeTime:1e3,modal:!0})}),$(".exam_answ span").on("click",function(){$(this).addClass("on").siblings().removeClass("on")}),$("#sizeCtrl li").hover(function(){$(this).addClass("active").siblings().removeClass("active")}),$("#sizeCtrl li").click(function(){$(this).addClass("active").siblings().removeClass("active");var e=$(".examCon").css("font-size"),t=parseFloat(e,10),a=e.slice(-2);$(this).hasClass("big")?t=16:$(this).hasClass("sml")?t=12:$(this).hasClass("mid")&&(t=14),$(".examCon").css("font-size",t+a),$(".custom-radio label").css("font-size",t+a),$(".custom-checkbox label").css("font-size",t+a)});